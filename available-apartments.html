<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV to Table</title>
    <!-- Cache-busting query parameter added to CSS and JS links -->
    <link rel="stylesheet" href="styles.css?cb=${Date.now()}">
    <script src="script.js?cb=${Date.now()}"></script>
    <link rel="icon" href="data:,"> <!-- Suppress favicon request -->
    <style>
      table {
        width: 100%;
        border-collapse: collapse;
      }

      th, td {
        padding: 8px;
        border: 1px solid #ddd;
        text-align: center; /* Center align text horizontally */
        vertical-align: middle; /* Center align text vertically */
      }

      /* Add styles to table for auto-width columns and no text wrapping */
      table {
        table-layout: auto; /* Auto-width columns */
      }

      th {
        white-space: nowrap; /* Prevent text wrapping in headers */
        text-align: center; /* Center align text horizontally */
      }

      td {
        white-space: nowrap; /* Prevent text wrapping in data rows */
        text-align: center; /* Center align text horizontally */
        vertical-align: middle; /* Center align text vertically */
      }
    </style>
</head>
<body>

<script>
  const PROXY_URL = "https://script.google.com/macros/s/AKfycbz1QKg50ahv7tzHgGTp4SEorFto0Aq3zgBvT9AuHckhG5DuH4NIl6asaqsqfJYpyvWA/exec";

  async function loadCsv() {
    // cache-buster so CloudFront/browser wonâ€™t reuse a cached response
    const url = `${PROXY_URL}?cb=${Date.now()}`;

    const res = await fetch(url);
    if (!res.ok) throw new Error("Proxy fetch failed: " + res.status);

    const csvJson = await res.json();
    console.log("CSV JSON:", csvJson); // Output CSV JSON to console for testing

    // Filter rows where Website Available? is YES
    const filteredRows = csvJson.rows.filter(row => row["Website Available?"] === "YES");

    // Remove Address, Section 8 valid, and Website Available? columns
    const filteredHeaders = csvJson.headers.filter(header => header !== "Address" && header !== "Section 8 valid" && header !== "Website Available?");

    // Create table
    const table = document.createElement("table");
    table.style.tableLayout = "auto"; // Auto-width columns

    // Add headers
    const headerRow = document.createElement("tr");
    filteredHeaders.forEach(header => {
      const th = document.createElement("th");
      th.textContent = header;
      th.style.whiteSpace = "nowrap"; // Prevent text wrapping in headers
      th.style.textAlign = "center"; // Center align text horizontally
      headerRow.appendChild(th);
    });
    table.appendChild(headerRow);

    // Add rows
    filteredRows.forEach(row => {
      const tr = document.createElement("tr");
      filteredHeaders.forEach(header => {
        const td = document.createElement("td");
        td.style.whiteSpace = "nowrap"; // Prevent text wrapping in data rows
        td.style.textAlign = "center"; // Center align text horizontally
        td.style.verticalAlign = "middle"; // Center align text vertically
        if (header === "AirBNB Link" && row[header]) {
          const a = document.createElement("a");
          a.href = row[header];
          a.textContent = "View";
          a.target = "_blank";
          td.appendChild(a);
        } else {
          td.textContent = row[header] || ""; // Use empty string if value is undefined
        }
        tr.appendChild(td);
      });
      table.appendChild(tr);
    });

    document.body.appendChild(table);
  }

  loadCsv().catch(console.error);
</script>

</body>
</html>